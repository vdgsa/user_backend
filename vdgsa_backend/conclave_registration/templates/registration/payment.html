{% extends 'registration/registration_base.html' %}
{% block content %}

{% load vdgsa_tags %}

<h3>Summary & Payment</h3>

<p>Summary of work study, class selections, and t-shirts</p>
<p>Validation check that they completed all required sections</p>
<!-- <p>TODO: what do we want to summarize here? (work study, class selections, and t-shirts?)</p>
<p>TODO: Check that all sections have been filled out</p> -->

<form method="post" id="conclave-go-to-payment-form">
  {% csrf_token %}
  <div class="row">
    <div class="col-md-6">
      <label for="id_donation">
        Would you like to make a donation to help make conclave more affordable to others?
      </label>
      <div class="row">
        <div class="col-6">
          <div class="d-flex align-items-center mb-3">
            <div class="me-1">$</div>
            {{form.donation | add_classes:"form-control"}}
          </div>
        </div>
      </div>

      <div class="form-field-errors mt-1">
        {{field.errors}}
      </div>
    </div>
  </div>

  <p>
    Some text here about when we'll charge their card, how they won't
    be able to make changes after they enter their payment info, and how
    we don't store their credit card number.
  </p>

  <div class="row">
    <div class="col-md-4">
      {% include 'utils/form_field.tmpl' with field=form.name_on_card %}
    </div>
  </div>
  <div class="row mt-2">
    <div class="col-md-4">
      {% include 'utils/form_field.tmpl' with field=form.card_number %}
    </div>
  </div>
  <div class="row mt-1">
    <div class="col-6 col-md-4">
      <div class="row gx-2">
        <div class="col-5">
          {% include 'utils/form_field.tmpl' with field=form.expiration_month label='Exp' %}
        </div>
        <div class="col-7">
          <!-- Empty label for horizontal alignment -->
          {% include 'utils/form_field.tmpl' with field=form.expiration_year label='  ' %}
        </div>
      </div>
    </div>
    <div class="col-6 col-md-2">
      {% include 'utils/form_field.tmpl' with field=form.cvc label="CVC" %}
    </div>
  </div>

  {% if stripe_error %}
  <div class="mt-2" id="stripe-error">{{stripe_error}}</div>
  {% endif %}

  <div class="mt-3">
    <button type="submit" class="btn btn-primary">Finalize Registration</button>
  </div>

  {% if form.non_field_errors %}
    <div class="non-field-errors">
    {% for err in form.non_field_errors %}
      <p class="form-error">{{ err }}</p>
    {% endfor %}
    </div>
  {% endif %}
</form>

<script>
$().ready(function() {
  if ($('#stripe-error').length) {
    document.getElementById('stripe-error').scrollIntoView();
  }
});
</script>

{% endblock %}

{% block page_style %}
{{block.super}}
<style>
  #stripe-error {
    color: crimson;
    font-weight: bold;
  }
</style>
{% endblock %}
