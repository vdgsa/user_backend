{% load conclave_tags %}

{% with registration_entry.housing as housing %}

<div class="fs-5">Program</div>
<div id="chosen-program" class="ps-3">
  <b>{{registration_entry.program | format_program}}</b>
</div>

{% if class_selection_required %}
<div class="fs-5 mt-2">Work-Study</div>
<div id="work-study-summary" class="ps-3">
  Applying for a work-study position:
  <b>
    {% if registration_entry.work_study %}
    Yes
    {% else %}
    No
    {% endif %}
  </b>
</div>

<div class="fs-5 mt-2">Instruments</div>
<div id="instruments-summary">
  {% with is_beginner=registration_entry.program|is_beginner_program %}
    {% if is_beginner %}
      {% if registration_entry.beginner_instruments.needs_instrument == 'yes' %}
        <div class="ps-3">Needs help finding an instrument</div>
      {% else %}
        <div class="ps-3">Bringing a {{registration_entry.beginner_instruments.instrument_bringing}} viol</div>
      {% endif %}
    {% elif not registration_entry.instruments_bringing.count %}
    <div id="no-instruments-message" class="ps-3">You are not bringing any instruments.</div>
    {% else %}
    <ul>
      {% for instrument in registration_entry.instruments_bringing.all %}
      <li>{{instrument}}</li>
      {% endfor %}
    </ul>
    {% endif %}
  {% endwith %}
</div>

<div class="fs-5 mt-2">Class Preferences</div>
<div id="classes-summary" class="ps-3">
{% comment %}
TODO: Update class summary based on selected program

  {% if class_selection_required and registration_entry.regular_class_choices.num_classes_selected == 0 %}
  <div id="no-classes-message">
    No classes selected.
  </div>
  {% else %}
  <div>Period 1</div>
  <ul>
    <li>
      1st Choice:
      {% firstof registration_entry.regular_class_choices.period1_choice1 'No class' %}
      {% if registration_entry.regular_class_choices.period1_choice1 %}
        ({% firstof registration_entry.regular_class_choices.period1_choice1_instrument 'Any' %})
      {% endif %}
    </li>
    <li>
      2nd Choice:
      {% firstof registration_entry.regular_class_choices.period1_choice2 'No class' %}
      {% if registration_entry.regular_class_choices.period1_choice2 %}
        ({% firstof registration_entry.regular_class_choices.period1_choice2_instrument 'Any' %})
      {% endif %}
    </li>
    <li>
      3rd Choice:
      {% firstof registration_entry.regular_class_choices.period1_choice3 'No class' %}
      {% if registration_entry.regular_class_choices.period1_choice3 %}
        ({% firstof registration_entry.regular_class_choices.period1_choice3_instrument 'Any' %})
      {% endif %}
    </li>
  </ul>
  <div>Period 2</div>
  <ul>
    <li>
      1st Choice:
      {% firstof registration_entry.regular_class_choices.period2_choice1 'No class' %}
      {% if registration_entry.regular_class_choices.period2_choice1 %}
        ({% firstof registration_entry.regular_class_choices.period2_choice1_instrument 'Any' %})
      {% endif %}
    </li>
    <li>
      2nd Choice:
      {% firstof registration_entry.regular_class_choices.period2_choice2 'No class' %}
      {% if registration_entry.regular_class_choices.period2_choice2 %}
        ({% firstof registration_entry.regular_class_choices.period2_choice2_instrument 'Any' %})
      {% endif %}
    </li>
    <li>
      3rd Choice:
      {% firstof registration_entry.regular_class_choices.period2_choice3 'No class' %}
      {% if registration_entry.regular_class_choices.period2_choice3 %}
        ({% firstof registration_entry.regular_class_choices.period2_choice3_instrument 'Any' %})
      {% endif %}
    </li>
  </ul>
  <div>Period 3</div>
  <ul>
    <li>
      1st Choice:
      {% firstof registration_entry.regular_class_choices.period3_choice1 'No class' %}
      {% if registration_entry.regular_class_choices.period3_choice1 %}
        ({% firstof registration_entry.regular_class_choices.period3_choice1_instrument 'Any' %})
      {% endif %}
    </li>
    <li>
      2nd Choice:
      {% firstof registration_entry.regular_class_choices.period3_choice2 'No class' %}
      {% if registration_entry.regular_class_choices.period3_choice2 %}
        ({% firstof registration_entry.regular_class_choices.period3_choice2_instrument 'Any' %})
      {% endif %}
    </li>
    <li>
      3rd Choice:
      {% firstof registration_entry.regular_class_choices.period3_choice3 'No class' %}
      {% if registration_entry.regular_class_choices.period3_choice3 %}
        ({% firstof registration_entry.regular_class_choices.period3_choice3_instrument 'Any' %})
      {% endif %}
    </li>
  </ul>
  <div>Period 4</div>
  <ul>
    <li>
      1st Choice:
      {% firstof registration_entry.regular_class_choices.period4_choice1 'No class' %}
      {% if registration_entry.regular_class_choices.period4_choice1 %}
        ({% firstof registration_entry.regular_class_choices.period4_choice1_instrument 'Any' %})
      {% endif %}
    </li>
    <li>
      2nd Choice:
      {% firstof registration_entry.regular_class_choices.period4_choice2 'No class' %}
      {% if registration_entry.regular_class_choices.period4_choice2 %}
        ({% firstof registration_entry.regular_class_choices.period4_choice2_instrument 'Any' %})
      {% endif %}
    </li>
    <li>
      3rd Choice:
      {% firstof registration_entry.regular_class_choices.period4_choice3 'No class' %}
      {% if registration_entry.regular_class_choices.period4_choice3 %}
        ({% firstof registration_entry.regular_class_choices.period4_choice3_instrument 'Any' %})
      {% endif %}
    </li>
  </ul>
  {% endif %}
{% endcomment %}
</div>
{% endif %}

<div class="fs-5 mt-2">Housing</div>
<div id="housing-summary" class="ps-3">
  <div>Room type: {{housing.room_type | format_room_type}}</div>
  {% if housing.room_type == 'double' %}
  <div>Requested roommate: {% firstof housing.roommate_request 'No preference' %}</div>
  {% endif %}
  {% if housing.room_type != 'off_campus' %}
  <div>Requested suite with: {% firstof housing.share_suite_request 'No preference' %}</div>
  <div>Requested room near: {% firstof housing.room_near_person_request 'No preference' %}</div>
  {% endif %}

  <div class="mt-2">
    <div>Arrival date: {{housing.arrival_day}}</div>
    <div>Departure date: {{housing.departure_day}}</div>
  </div>

  <div class="mt-2">
    <div>Dietary needs: {% firstof housing.dietary_needs|format_dietary_needs 'None' %}</div>
    {% if housing.other_dietary_needs %}
    <div>Additional dietary needs: {{housing.other_dietary_needs}}</div>
    {% endif %}
  </div>
</div>

<div class="fs-5 mt-2">T-Shirts</div>
{% with registration_entry.tshirts as tshirts %}
  {% if not tshirts or not tshirts.tshirt1 and not tshirts.tshirt2 %}
  <div id="no-tshirts-message" class="ps-3">No T-Shirts</div>
  {% else %}
    <ul id="tshirt-summary">
      {% if tshirts.tshirt1 %}
      <li>T-Shirt 1: <b>{{tshirts.tshirt1}}</b></li>
      {% endif %}
      {% if tshirts.tshirt2 %}
      <li>T-Shirt 2: <b>{{tshirts.tshirt2}}</b></li>
      {% endif %}
    </ul>
  {% endif %}
{% endwith %}
{% endwith %}

<hr>

<table id="charges-table" class="table">
  <thead>
    <tr>
      <td class="fs-5">Summary of Charges So Far</td>
      <td></td>
    </tr>
  </thead>
  <tbody>
    {% for charge in charges_summary.charges %}
    <tr>
      <td>{{charge.display_name}}</td>
      <td style="text-align: right">{{charge.amount}}</td>
    </tr>
    {% endfor %}

    {% if charges_summary.apply_work_study_scholarship %}
    <tr>
      <td>Work-Study Scholarship (If Awarded*)</td>
      <td style="text-align: right">-{{conclave_config.work_study_scholarship_amount}}</td>
    </tr>
    {% endif %}

    {% if charges_summary.apply_housing_subsidy %}
    <tr>
      <td>Limited-Income Housing Subsidy (If Available)</td>
      <td style="text-align: right">-{{conclave_config.housing_subsidy_amount}}</td>
    </tr>
    {% endif %}

    <tr>
      <td><b>Subtotal</b></td>
      <td style="text-align: right">{{charges_summary.subtotal}}</td>
    </tr>

    {% if charges_summary.apply_canadian_discount %}
    <tr>
      <td>Canadian Exchange Rate Discount</td>
      <td style="text-align: right">-{{conclave_config.canadian_discount_percent}}%</td>
    </tr>
    {% endif %}

    <tr>
      <td><b>Total</b></td>
      <td style="text-align: right">${{charges_summary.total}}</td>
    </tr>
  </tbody>
</table>
{% if charges_summary.apply_work_study_scholarship %}
<div id="work-study-charges-msg">
  *Work-Study positions will be awarded by June 15. Work-Study applicants
  will not be charged until positions are finalized.
</div>
{% endif %}
